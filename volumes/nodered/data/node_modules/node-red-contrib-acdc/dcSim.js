 module.exports = function(RED) {
	function DCSimulation(config) {
		RED.nodes.createNode(this,config);
		var node = this;

		console.log("init DC Simulation: " + this.name);
		this.status({fill:"green",shape:"dot",text:"ok"});

		node.on('input', function(msg) {
			let voltage = {};
			let current = {};
			let state = "ON";
			let vAmp = 1.0;
			let cAmp = 0;

			if(!(msg.vAmp === undefined)) 
				vAmp = Number(msg.vAmp);
			if(!(msg.cAmp === undefined)) 
				cAmp = Number(msg.cAmp);
			if(!(msg.state === undefined)) 
				state = msg.state;
			
			if(state == "ON" || state == "on") {
				voltage = {payload: vAmp + (Math.random()-0.5) * 3, topic: "voltage" };
				current = {payload: cAmp + (Math.random()-0.5) * 5, topic: "current"};
			} else if(state == "OFF" || state == "off") {
				voltage = {payload: vAmp + (Math.random()-0.5) * 2, topic: "voltage" };
				current = {payload: 0, topic: "current"};
			} else if(state == "FAIL" || state == "fail") {
				voltage = {payload: vAmp/2 + (Math.random()-0.5) * 2, topic: "voltage" };
				current = {payload: 5 + (Math.random()-0.5) * 2, topic: "current"};
			}
				
			node.send([ voltage, current ]);
		});
	}
	RED.nodes.registerType("DC Simulation", DCSimulation);
}
