module.exports = function(RED) {
    function demoSignals(config) {
        RED.nodes.createNode(this,config);
        var node = this;
		var startTime = Date.now() / 1000; 

		console.log("init demo signal: " + this.name);
		this.status({fill:"green",shape:"dot",text:"ok"});

        node.on('input', function(msg) {
            let time = msg.payload / 1000;
			let msg1, msg2, msg3;
			let amplitud = 1.0
			let period = 3600.0

			if(msg.amplitud) 
				amplitud = Number(msg.amplitud);
			
			if(msg.period)
				period = Number(msg.period);
			
			msg1 = { payload: amplitud * Math.sin((2 * Math.PI ) * ((time - startTime) % period) / period) };
			if (((time - startTime) % period) / period <= 0.5 )
				msg2 = {payload:amplitud };
			else
				msg2 = {payload: -1 * amplitud};
			msg3 =  {payload: 2 * amplitud * Math.random() - amplitud };

			//console.log("demo signals: " + msg1.payload +" "+ msg2.payload +" "+ msg3.payload +"\r\n");	
            node.send([ msg1 , msg2, msg3 ]);
        });
    }
    RED.nodes.registerType("demo signals",demoSignals);
}
